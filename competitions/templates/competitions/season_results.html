{% extends "base/base.html" %}
{% load i18n %}
{% load roots_tags %}
{% load sekizai_tags %}

{% block content %}

{% define content_heading %}
    {% blocktrans with season_competition=season.competition season_year=season.year season_name=season.name %}
        Results of {{ season_competition }}, {{ season_year }}. rocnika - {{ season_name }}
    {% endblocktrans %}
{% enddefine%}

{% define season_dropdown_button %}
    {% include "competitions/season_dropdown_button.html" with view_name='competitions_season_results' %}
{% enddefine %}

{% define content %}

  <!-- navigation-tabs -->
  <ul class="nav nav-tabs">
  {% for series in season.series %}
        <li {% if series.is_nearest_deadline %}class="active"{% endif %}>
          <a href="#series-{{series.pk}}" data-toggle="tab">{{series.name}}</a>
        </li>
  {% endfor %}
        <li>
          <a href="#complete_results" data-toggle="tab">{% trans "Complete results" %}</a>
        </li>
  </ul>
  <!-- end navigation-tabs -->

  <!-- tab-content -->
  <div class="tab-content">

  {% for series in season.series %}
      <div class="tab-pane fade {% if series.is_nearest_deadline %}in active{% endif %}" id="series-{{series.pk}}">

      <br/>
      <div class="row">
          <div class="col-md-8">
              <blockquote class="blockquote-info">
                <h4>
                  <span class="glyphicon glyphicon-time"></span>
                  {% trans "Series deadline:" %}
                  <span class="text-{% if series.is_past_submission_deadline%}danger{% else %}success{% endif %}">
                    {{series.submission_deadline}}
                  </span>
                  </h4>
              </blockquote>
          </div>
          <div class="col-md-4">
            {{ season_dropdown_button }}
          </div>
      </div>

  <table class="table table-condensed table-striped">
  <thead>
  <tr>
    <th> Name </th>
    {% for problem in series.problemset.problems.all %}
      <th> {% trans "Problem" %} {{forloop.counter}} </th>
    {% endfor %}
    <th> {% trans "Total" %} </th>
    </tr>
    </thead>

    <tbody>
    {% for result_row in series.results %}
      <tr>
      <td> {{result_row.0.get_full_name|default:result_row.0.username}} </td>
        {% for solution in result_row.1 %}
        <td>
          {% if solution == None %}
            --
          {% else %}
            {% if solution.score == None %} ? {% else %}{{ solution.score }}{% endif %}
          {% endif %}
        </td>
        {% endfor %}
        <td>{{ result_row.2  }}</td>
        </tr>
    {% endfor %}
    </tbody>
    </table>
    </div><!-- tabe-panel -->
    {% endfor %}

    <div class="tab-pane fade {% if series.is_nearest_deadline %}in active{% endif %}" id="complete_results">

    <table class="table table-condensed table-striped">
    <thead>
    <tr>
    <th> Name </th>
    <th>
    <table class="table table-condensed">
    {% for problem in season.series.0.problemset.problems.all %}
        <th> {% trans "Problem " %}{{forloop.counter}}. </th>
    {% endfor %}
    </table>
    </th>
    <th> {% trans "Subtotal" %} </th>
    <th> {% trans "Total" %} </th>
    </tr>
    </thead>

    <tbody>
    {% for result_row in season.results %}
      <tr>
      <td> {{result_row.0.get_full_name|default:result_row.0.username}} </td>
      <td>
        <table class="table table-condensed">
        {% for series_result in result_row.1 %}
            <tr>
            {% for solution in series_result.0 %}
            <td>
              {% if solution == None %}
                --
              {% else %}
                {% if solution.score == None %} ? {% else %}{{ solution.score }}{% endif %}
              {% endif %}
            </td>
            {% endfor %}
            <td> {{ series_result.1 }} </td>
            </tr>
        {% endfor %}
        </table>
      </td>
      <td>{{ result_row.2  }}</td>
      </tr>
    {% endfor %}
    </tbody>
    </table>

    </div><!-- tabe-panel -->

  </div> <!-- tab-content -->


{% enddefine %}

{% include "base/panel.html" with content_heading=content_heading content=content %}

{% endblock %}
